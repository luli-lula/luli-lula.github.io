<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>SQL必知必会笔记 | lula&#39;s blog</title>
<meta name="keywords" content="Data Analyst">
<meta name="description" content="
Sams Teach Yourself SQL in 10 Minutes - Fourth Edition
语句备份，方便查阅，SQL Server版本


检索数据
排序数据
过滤语句
模糊过滤
字段计算
函数
分组数据
嵌套查询
连接表
组合查询
插入数据
更新删除数据
创建和操纵类
使用视图
使用存储过程(批处理)
管理事务处理（transaction processing）
使用游标
高级SQL特性

约束
索引
触发器




检索数据

SELECT语句

检索单个列
SELECT column_name FROM tablename;

检索多个列
SELECT col_name1, col_name2 FROM tablename;

检索所有列
SELECT * from tablename;

检索不同的值, 使用 DISTINCT关键词
SELECT DISTINCT col_name1 FROM tablename;
注意：DISTINCT关键字用于所有的列，不仅仅是跟在其后的那一列。

返回前五行结果
SELECT top 5 prod_name
FROM Products

使用注释
----注释的方法---
  /* 这是注释
  的方法2 */
排序数据

ORDER BY 语句">
<meta name="author" content="lula">
<link rel="canonical" href="http://localhost:1313/posts/sql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%E7%AC%94%E8%AE%B0/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk&#43;4bvpN&#43;sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/sql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%E7%AC%94%E8%AE%B0/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/posts/sql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%E7%AC%94%E8%AE%B0/">
  <meta property="og:site_name" content="lula&#39;s blog">
  <meta property="og:title" content="SQL必知必会笔记">
  <meta property="og:description" content=" Sams Teach Yourself SQL in 10 Minutes - Fourth Edition 语句备份，方便查阅，SQL Server版本
检索数据 排序数据 过滤语句 模糊过滤 字段计算 函数 分组数据 嵌套查询 连接表 组合查询 插入数据 更新删除数据 创建和操纵类 使用视图 使用存储过程(批处理) 管理事务处理（transaction processing） 使用游标 高级SQL特性 约束 索引 触发器 检索数据 SELECT语句
检索单个列 SELECT column_name FROM tablename; 检索多个列 SELECT col_name1, col_name2 FROM tablename; 检索所有列 SELECT * from tablename; 检索不同的值, 使用 DISTINCT关键词 SELECT DISTINCT col_name1 FROM tablename; 注意：DISTINCT关键字用于所有的列，不仅仅是跟在其后的那一列。 返回前五行结果 SELECT top 5 prod_name FROM Products 使用注释 ----注释的方法--- /* 这是注释 的方法2 */ 排序数据 ORDER BY 语句">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2017-05-28T15:04:44+00:00">
    <meta property="article:modified_time" content="2017-05-28T15:04:44+00:00">
    <meta property="article:tag" content="Data Analyst">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SQL必知必会笔记">
<meta name="twitter:description" content="
Sams Teach Yourself SQL in 10 Minutes - Fourth Edition
语句备份，方便查阅，SQL Server版本


检索数据
排序数据
过滤语句
模糊过滤
字段计算
函数
分组数据
嵌套查询
连接表
组合查询
插入数据
更新删除数据
创建和操纵类
使用视图
使用存储过程(批处理)
管理事务处理（transaction processing）
使用游标
高级SQL特性

约束
索引
触发器




检索数据

SELECT语句

检索单个列
SELECT column_name FROM tablename;

检索多个列
SELECT col_name1, col_name2 FROM tablename;

检索所有列
SELECT * from tablename;

检索不同的值, 使用 DISTINCT关键词
SELECT DISTINCT col_name1 FROM tablename;
注意：DISTINCT关键字用于所有的列，不仅仅是跟在其后的那一列。

返回前五行结果
SELECT top 5 prod_name
FROM Products

使用注释
----注释的方法---
  /* 这是注释
  的方法2 */
排序数据

ORDER BY 语句">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "SQL必知必会笔记",
      "item": "http://localhost:1313/posts/sql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%E7%AC%94%E8%AE%B0/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "SQL必知必会笔记",
  "name": "SQL必知必会笔记",
  "description": " Sams Teach Yourself SQL in 10 Minutes - Fourth Edition 语句备份，方便查阅，SQL Server版本\n检索数据 排序数据 过滤语句 模糊过滤 字段计算 函数 分组数据 嵌套查询 连接表 组合查询 插入数据 更新删除数据 创建和操纵类 使用视图 使用存储过程(批处理) 管理事务处理（transaction processing） 使用游标 高级SQL特性 约束 索引 触发器 检索数据 SELECT语句\n检索单个列 SELECT column_name FROM tablename; 检索多个列 SELECT col_name1, col_name2 FROM tablename; 检索所有列 SELECT * from tablename; 检索不同的值, 使用 DISTINCT关键词 SELECT DISTINCT col_name1 FROM tablename; 注意：DISTINCT关键字用于所有的列，不仅仅是跟在其后的那一列。 返回前五行结果 SELECT top 5 prod_name FROM Products 使用注释 ----注释的方法--- /* 这是注释 的方法2 */ 排序数据 ORDER BY 语句\n",
  "keywords": [
    "Data Analyst"
  ],
  "articleBody": " Sams Teach Yourself SQL in 10 Minutes - Fourth Edition 语句备份，方便查阅，SQL Server版本\n检索数据 排序数据 过滤语句 模糊过滤 字段计算 函数 分组数据 嵌套查询 连接表 组合查询 插入数据 更新删除数据 创建和操纵类 使用视图 使用存储过程(批处理) 管理事务处理（transaction processing） 使用游标 高级SQL特性 约束 索引 触发器 检索数据 SELECT语句\n检索单个列 SELECT column_name FROM tablename; 检索多个列 SELECT col_name1, col_name2 FROM tablename; 检索所有列 SELECT * from tablename; 检索不同的值, 使用 DISTINCT关键词 SELECT DISTINCT col_name1 FROM tablename; 注意：DISTINCT关键字用于所有的列，不仅仅是跟在其后的那一列。 返回前五行结果 SELECT top 5 prod_name FROM Products 使用注释 ----注释的方法--- /* 这是注释 的方法2 */ 排序数据 ORDER BY 语句\n--注意：在指定一条ORDER BY子句时，应该保证它是SELECT语句中最后一条子句-- SELECT col_name FROM tablename ORDER BY col_name --多列排序-- SELECT col_name1, col_name2, col_name3 FROM tablename ORDER BY col_name1, col_name2; --降序排列-- SELECT col_name1, col_name2, col_name3 FROM tablename ORDER BY col_name1 DESC, col_name2; 过滤语句 WHERE 语句\nSELECT col_name1, col_name2 FROM tablename WHERE col_name1 = 3.49; SELECT col_name, col_name2 FROM tablename WHERE co_name2 BETWEEN 5 AND 10; SELECT col_name FROM tablename WHERE col_name IS NULL; --AND语句--- SELECT col_name1, col_name2, col_name3 FROM tablename WHERE col_name1='ABC' AND col_name2 \u003c= 4 --OR语句--- SELECT col_name1, col_name2, col_name3 FROM tablename WHERE col_name1='ABC' OR col_name2 \u003c= 4 --注意：SQL在处理OR操作符前，优先处理AND操作符。使用圆括号即可解决此问题。 SELECT prod_name, prod_price FROM Products WHERE (vend_id = 'DLL01' OR vend_id = ‘BRS01’) AND prod_price \u003e= 10; --IN语句，与OR语句相当，但是速度更快，而且可以嵌套SELECT语句 SELECT prod_name, prod_price FROM Products WHERE vend_in IN ('DLL01', 'BSLKJL') ORDER BY prod_name; --NOT语句，与\u003c\u003e类似，但是可以与IN配合使用完成更为复杂的筛选-- SELECT prod_name FROM Products WHERE NOT vend_id='DLL01' ORDER BY prod_name; 模糊过滤 LIKE\n---%表示任何字符出现任意次数,%还能匹配0个字符,注意：%不能匹配NULL;需要注意前后的空格--- SELECT prod_id, pro_name FROM Products WHERE prod_name LIKE 'Fish%'; SELECT prod_id, prod_name FROM Products WHERE prod_name LIKE '%bean bag%';+ SELECT prod_id, prod_name FROM Products WHERE prod_name LIKE 'F%y'; --下划线匹配单个字符-------------- SELECT prodid, prodname FROM Products WHERE prod_name LIKE '__inch teddy bear'; --方括号[]匹配一个字符的可能选项，只有Access和SQL Server中才可以用-- --例如匹配J或M开头的任意cust_contact-- SELECT cust_contact FROM Customers WHERE cust_contact LIKE '[JM]%' ORDER BY cust_contact --方括号通配符可以使用^来否定-- SELECT cust_contact FROM Customers WHERE cust_contact LIKE '[^JM]%' ORDER BY cust_contact --上面的例子可以直接用NOT来重写-- SELECT cust_contact FROM Customers WHERE NOT cust_contact LIKE '[JM]%' ORDER BY cust_contact 不要过度使用通配符。如果其他操作符能达到相同的目的，应该使用其他操作符。 在确实需要使用通配符时，也尽量不要把它们用在搜索模式的开始处。把通配符置于开始处，搜索起来是最慢的。 仔细注意通配符的位置。如果放错地方，可能不会返回想要的数据。 字段计算 +号连接字段\n--拼接字段-- --Access和SQL Server使用+号。DB2、Oracle、PostgreSQL、SQLite和Open Office Base使用||。详细请参阅具体的DBMS文档。 --大多数DBMS都支持RT RIM()（正如刚才所见，它去掉字符串右边的空格）、LT RIM()（去掉字符串左边的空格）以及T RIM()（去掉字符串 左右两边的空格）。 SELECT RTRIM(vend_name)+'('+RTRIM(vend_country)+')' AS vend_title FROM Vendors ORDER BY vend_name --字段之间加减乘除-- SELECT prod_id, quantity, item_price, quantity*item_price AS expended_price FROM OrderItems WHERE order_num=20008; 函数 文本函数\n函数 说 明 LEFT() 返回字符串左边的字符 LENGTH() 返回字符串的长度 LOWER() 将字符串转为小写 UPPER() 将字符串转为大写 LTRIM() 去掉字符串左边的空格 RIGHT() 返回字符串右边的字符 RTRIM() 去掉字符串右边的空格 SOUNDEX() 返回字符串的SOUNDEX值 --找出发音类似的-- SELECT cust_name,cust_contact FROM Customers where SOUNDEX(cust_contact)=SOUNDEX('Michael Green') 时间函数\nSELECT order_num FROM Orders WHERE DATEPART(yy,order_date) = 2012 数值处理函数\n函数 说明 ABS() 返回绝对值 EXP() 返回指数值 PI() 返回圆周率 SQRT() 返回平方根 聚集函数【AVG() COUNT() MAX() MIN() SUM()】\n使用COUNT (*)对表中行的数目进行计数，不管表列中包含的是空值（NULL）还是非空值。 使用COUNT (column)对特定列中具有值的行进行计数，忽略NULL值。 --求平均的时候要求不重复 SELECT AVG(DISTINCT prod_price) AS avg_price FROM Products WHERE vend_id = 'DLL01'; 分组数据 GROUP BY子句和HAVING子句\nSELECT vend_id,COUNT(*) AS num_prods FROM Products GROUP BY vend_id --结果--- vend_id\tnum_prods BRS01 3 DLL01 4 FNG01 2 WHERE只能过滤行，而不是分组，分组过滤需要HAVING SELECT vend_id,COUNT(*) AS num_prods FROM Products GROUP BY vend_id HAVING COUNT(*)\u003e2 嵌套查询 --------------------------------------- SELECT cust_name,cust_contact FROM Customers WHERE cust_id IN (SELECT cust_id FROM Orders WHERE order_num IN (SELECT order_num FROM OrderItems WHERE prod_id = 'RGAN01')); ------------------------------------ SELECT cust_name, cust_contact FROM Customers, Orders, OrderItems WHERE Customers.cust _id = Orders.cust _id AND OrderItems.order_num = Orders.order_num AND prod_id = 'RGAN01'; ------------------------------------ SELECT cust_name, cust_state, (SELECT COUNT(*) FROM Orders WHERE Orders.cust_id = Customers.cust_id) AS orders FROM Customers\tORDER BY cust_name\t连接表 join\n------等值连接----------- SELECT vend_name,prod_name,prod_price FROM Vendors,Products WHERE Vendors.vend_id = Products.vend_id ------内连接------------- SELECT vend_name,prod_name,prod_price FROM Vendors INNER JOIN Products ON Vendors.vend_id = Products.vend_id ------外连接--------------- -INNER JOIN 产生的结果是AB的交集 -LEFT [OUTER] JOIN 产生表A的完全集，而B表中匹配的则有值，没有匹配的则以null值取代。 -RIGHT [OUTER] JOIN 产生表B的完全集，而A表中匹配的则有值，没有匹配的则以null值取代。 -FULL [OUTER] JOIN 产生A和B的并集。对于没有匹配的记录，则会以null做为值。 SELECT vend_name,prod_name,prod_price FROM Vendors LEFT OUTER JOIN Products ON Vendors.vend_id = Products.vend_id SELECT vend_name,prod_name,prod_price FROM Vendors RIGHT OUTER JOIN Products ON Vendors.vend_id = Products.vend_id -------表别名------------- SELECT cust_name,cust_contact FROM Customers AS C ,Orders AS O,OrderItems AS OI WHERE C.cust_id = O.cust_id AND OI.order_num = O.order_num AND prod_id = 'RGAN01'; --这个例子使用左外部联结来包含所有顾客，甚至包含那些没有任何订单的顾客。 SELECT Customers.cust_id, COUNT(Orders.order_num) AS num_ord FROM Cust omers LEFT OUTER JOIN Orders ON Customers.cust _id = Orders.cust _id GROUP BY Customers.cust _id; 组合查询 UNION函数 直接在两条SELECT语句之间，将结果合并在一起，类似在WHERE中使用OR函数，UNION会默认去除重复数据，UNION ALL不去除重复数据。ORDER BY函数必须放在最后一个SELECT语句中，并作用于最后的合并结果\n插入数据 INSERT INTO 按照列名来可以重复使用，可以只插入部分数据，\n------插入一行数据------------ INSERT INTO Customers(cust_id, cust_name, cust_city, cust_state, cust_zip, cust_country, cust_contact, cust_email) VALUES('1000000001', 'Village Toys', '200 Maple Lane', 'Detroit', 'MI', 'USA', 'John Smith', 'sales@villagetoys.com'); -----插入SELECT结果，只关注顺序，不关注筛选出的字段名------- INSERT INTO Customers(cust_id, cust_contact , cust_email, cust_name, cust_address, cust_city , cust_state, cust_zip, cust_country ) SELECT cust_id, cust_contact , cust_email, cust_name, cust_address, cust_city , cust_state, cust_zip, cust_country FROM CustNew; -----从一个表复制到另一个表------- SELECT * INTO CustCopy FROM Customers 更新删除数据 UPDATE DELETE\n----更新指定行------------- UPDATE Customers SET cust_contact = 'Sam Roberts', cust_email = 'sam@toyland.com' WHERE cust_id = '1000000006'; ------删除指定行-------- DELETE FROM Cust omers WHERE cust_id = '1000000006'; --DELETE只能删除行，删除列则用update --删除表中的所有数据TRUNCATE TABLE速度更快 创建和操纵类 ----创建表------------- CREATE TABLE Products ( prod_id char(10) NOT NULL , vend_id char(10) NOT NULL , prod_name char(255) NOT NULL , prod_price decimal(8,2) DEFAULT 1, prod_desc varchar(1000) NULL ); ------更新表--------- ALTER TABLE Vendos ADD vend_phone CHAR(20); ALTER TABLE Vendos DROP COULUMN vend_phone; ----删除表------- DROP TABLE CustCopy ; 每个DBMS对表重命名的支持有所不同。对于这个操作，不存在严格的标准。DB2、MariaDB、My SQL、Oracle和PostgreSQL用户使 用RENAME语句，SQL Server用户使用sp_rename存储过程，SQLite用户使用ALTER TABLE语句。 使用视图 CREATE VIEW viewname\n视图是虚拟的表 视图可以重用SQL语句 可以简化复杂SQL操作，在编写查询后，可以方便重用它，而不必知道其查询的细节 使用表的一部分而不是整个表 保护数据 更改数据的表现格式 视图不包含数据，每次使用的时候都会重新检索，因此如果特别复杂的SQL查询性能会下降的很厉害。 ---创建视图------ CREATE VIEW ProductCustomers AS SELECT cust_name,cust_contact,prod_id FROM Customers,Orders,OrderItems WHERE Customers.cust_id = Orders.cust_id AND OrderItems.order_item = Orders.order_num ---查看视图----------- --这条语句创建一个名为ProductCustomers的视图，它联结三个表，返回已订购了任意产品的所有顾客的列表。 SELECT * FROM ProductCustomers --检索订购了产品RGA N01的顾客 SELECT * FROM ProductCustomers WHERE prod_id = 'RGAN01' ----用视图重新格式化检索数据------ CREATE VIEW VendorLocations AS SELECT RTRIM(vend_name)+'('+RTRIM(vend_country)+')' AS vend_title FROM Vendors 使用存储过程(批处理) CREATE PROCEDURE MailingListCount AS DECLARE @cnt INTEGER SELECT @cnt = COUNT(*) FROM Customers WHERE NOT cust_email IS NULL RETURN @cnt DECLARE @ReturnValue INT EXECUTE @ReturnValue=MailingListCount; SELECT @ReturnValue 在Orders表中插入一个新订单 CREATE PROCEDURE NewOrder @cust_id CHAR(10) AS --Declare variable for order number DECLARE @order_num INTEGER --Get current highest order number SELECT @order_num = MAX(order_num) FROM Orders --Determine next order number SELECT @order_num = @order_num+1 --Insert new order INSERT INTO Orders(order_num,order_date,cust_id) VALUES(@order_num,GETDATE(),@cust_id) --Return order number RETURN @order_num; 此存储过程在O rders表中创建一个新订单。它只有一个参数，即下订单顾客的I D。订单号和订单日期这两列在存储过程中自动生成。代码首先声明一个局部变量来存储订单号。接着，检索当前最大订单号（使用MA X()函数）并增加1（使用SELECT 语句）。然后用INSERT 语句插入由新生成的订单号、当前系统日期（用GET DA T E()函数检索）和传递的顾客I D组成的订单。最后，用RET U RN @order_num返回订单号（处理订单物品需要它）。请注意，此代码加了注释，在编写存储过程时应该多加注释 CREATE PROCEDURE NewOrder @cust_id CHAR(10) AS --Insert new order INSERT INFO Orders(cust_id) VALUES(@cust_id) --Return order number SELECT order_num = @@IDENTITY 此存储过程也在Orders表中创建一个新订单。这次由DBMS生成订单号。大多数DBMS都支持这种功能；SQL Serv er中称这些自动增量的列为标识字段（i den t i t y f i el d），而其他DBMS称之为自动编号（au t o n u mber）或序列（sequ en ce）。传递给此过程的参数也是一个，即下订单的顾客ID。订单号和订单日期没有给出，DBMS对日期使用默认值（GETDATE()函数），订单号自动生成。怎样才能得到这个自动生成的I D？在SQL Serv er上可在全局变量@@IDENT ITY 中得到，它返回到调用程序（这里使用SELECT 语句）。 管理事务处理（transaction processing） COMMIT 和ROLLBACK语句\n事务处理是通过确保成批SQL操作要么完全执行，要么完全不执行 在使用事务处理时，有几个反复出现的关键词。下面是关于事务处理需要知道的几个术语： 事务（transaction ）指一组SQL语句； 回退（rollback）指撤销指定SQL语句的过程； 提交（commit）指将未存储的SQL语句结果写入数据库表； 保留点（savepoint）指事务处理中设置的临时占位符（pl aceholder），可以对它发布回退（与回退整个事务处理不同）。 BEGINT RANSACTION INSERT INTO Customers(cust_id,cust_name) VALUES('1000000010','ToysEmporium'); --定义保存点 SAVE TRANSACTION StartOrder; INSERT INTO Orders(order_num,order_date,cust_id) VALUES(20100,'2001/12/1','1000000010'); --若执行不成功就回退到保存点 IF @@ERROR\u003c\u003e0 ROLLBACK TRANSACTION StartOrder; INSERT INTO OrderItems(order_num,order_item,prod_id,quantity,item_price) VALUES(20100,1,'BR01',100,5.49); IF @@ERROR\u003c\u003e0 ROLLBACK TRANSACTION StartOrder; INSERT INTO OrderItems(order_num,order_item,prod_id,quantity,item_price) VALUES(20100,2,'BR03',100,10.99); IF @@ERROR\u003c\u003e0 ROLLBACK TRANSACTION StartOrder; COMMIT TRANSACTION 使用游标 --创建游标 --在上面两个版本中，DECLA RE语句用来定义和命名游标，这里为CustCursor。SELECT 语句定义一个包含没有电子邮件地址（NU LL值）的所有 顾客的游标。 DECLARE CustCursor CURSOR FOR SELECT * FROM Customers WHERE cust_email is NULL --------------------- DECLARE @cust_id CHAR(10), @cust_name CHAR(50), @cust_address CHAR(50), @cust_city CHAR(50), @cust_state CHAR(5), @cust_zip CHAR(10), @cust_country CHAR(50), @cust_contact CHAR(50), @cust_email CHAR(255) OPEN CustCursor FETCH NEXT FROM CustCursor INTO @cust_id,@cust_name,@cust_address, @cust_city,@cust_state,@cust_zip, @cust_country,@cust_contact,@cust_email WHILE @@FETCH_STATUS=0 BEGIN --占位符 FETCH NEXT FROM CustCursor INTO @cust_id,@cust_name,@cust_address, @cust_city,@cust_state,@cust_zip, @cust_country,@cust_contact,@cust_email END CLOSE CustCursor DEALLOCATE CustCursor 在此例中，为每个检索出的列声明一个变量，FET CH语句检索一行并保存值到这些变量中。使用WHILE循环处理每一行，条件WHILE @@FET CH_ST A T U S = 0在取不出更多的行时终止处理（退出循环）。这个例子也不进行具体的处理，实际代码中，应该用具体的处理代码替换其中的…占位符。 高级SQL特性 约束 索引 触发器 ",
  "wordCount" : "1075",
  "inLanguage": "en",
  "datePublished": "2017-05-28T15:04:44Z",
  "dateModified": "2017-05-28T15:04:44Z",
  "author":{
    "@type": "Person",
    "name": "lula"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/sql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%E7%AC%94%E8%AE%B0/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "lula's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="lula&#39;s blog (Alt + H)">lula&#39;s blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      SQL必知必会笔记
    </h1>
    <div class="post-meta"><span title='2017-05-28 15:04:44 +0000 UTC'>May 28, 2017</span>&nbsp;·&nbsp;lula

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e6%a3%80%e7%b4%a2%e6%95%b0%e6%8d%ae" aria-label="检索数据">检索数据</a></li>
                <li>
                    <a href="#%e6%8e%92%e5%ba%8f%e6%95%b0%e6%8d%ae" aria-label="排序数据">排序数据</a></li>
                <li>
                    <a href="#%e8%bf%87%e6%bb%a4%e8%af%ad%e5%8f%a5" aria-label="过滤语句">过滤语句</a></li>
                <li>
                    <a href="#%e6%a8%a1%e7%b3%8a%e8%bf%87%e6%bb%a4" aria-label="模糊过滤">模糊过滤</a></li>
                <li>
                    <a href="#%e5%ad%97%e6%ae%b5%e8%ae%a1%e7%ae%97" aria-label="字段计算">字段计算</a></li>
                <li>
                    <a href="#%e5%87%bd%e6%95%b0" aria-label="函数">函数</a></li>
                <li>
                    <a href="#%e5%88%86%e7%bb%84%e6%95%b0%e6%8d%ae" aria-label="分组数据">分组数据</a></li>
                <li>
                    <a href="#%e5%b5%8c%e5%a5%97%e6%9f%a5%e8%af%a2" aria-label="嵌套查询">嵌套查询</a></li>
                <li>
                    <a href="#%e8%bf%9e%e6%8e%a5%e8%a1%a8" aria-label="连接表">连接表</a></li>
                <li>
                    <a href="#%e7%bb%84%e5%90%88%e6%9f%a5%e8%af%a2" aria-label="组合查询">组合查询</a></li>
                <li>
                    <a href="#%e6%8f%92%e5%85%a5%e6%95%b0%e6%8d%ae" aria-label="插入数据">插入数据</a></li>
                <li>
                    <a href="#%e6%9b%b4%e6%96%b0%e5%88%a0%e9%99%a4%e6%95%b0%e6%8d%ae" aria-label="更新删除数据">更新删除数据</a></li>
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba%e5%92%8c%e6%93%8d%e7%ba%b5%e7%b1%bb" aria-label="创建和操纵类">创建和操纵类</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e8%a7%86%e5%9b%be" aria-label="使用视图">使用视图</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e5%ad%98%e5%82%a8%e8%bf%87%e7%a8%8b%e6%89%b9%e5%a4%84%e7%90%86" aria-label="使用存储过程(批处理)">使用存储过程(批处理)</a></li>
                <li>
                    <a href="#%e7%ae%a1%e7%90%86%e4%ba%8b%e5%8a%a1%e5%a4%84%e7%90%86transaction-processing" aria-label="管理事务处理（transaction processing）">管理事务处理（transaction processing）</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e6%b8%b8%e6%a0%87" aria-label="使用游标">使用游标</a></li>
                <li>
                    <a href="#%e9%ab%98%e7%ba%a7sql%e7%89%b9%e6%80%a7" aria-label="高级SQL特性">高级SQL特性</a><ul>
                        
                <li>
                    <a href="#%e7%ba%a6%e6%9d%9f" aria-label="约束">约束</a></li>
                <li>
                    <a href="#%e7%b4%a2%e5%bc%95" aria-label="索引">索引</a></li>
                <li>
                    <a href="#%e8%a7%a6%e5%8f%91%e5%99%a8" aria-label="触发器">触发器</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><blockquote>
<p>Sams Teach Yourself SQL in 10 Minutes - Fourth Edition
语句备份，方便查阅，SQL Server版本</p>
</blockquote>
<ul>
<li>检索数据</li>
<li>排序数据</li>
<li>过滤语句</li>
<li>模糊过滤</li>
<li>字段计算</li>
<li>函数</li>
<li>分组数据</li>
<li>嵌套查询</li>
<li>连接表</li>
<li>组合查询</li>
<li>插入数据</li>
<li>更新删除数据</li>
<li>创建和操纵类</li>
<li>使用视图</li>
<li>使用存储过程(批处理)</li>
<li>管理事务处理（transaction processing）</li>
<li>使用游标</li>
<li>高级SQL特性
<ul>
<li>约束</li>
<li>索引</li>
<li>触发器</li>
</ul>
</li>
</ul>
<!-- more -->
<h1 id="检索数据">检索数据<a hidden class="anchor" aria-hidden="true" href="#检索数据">#</a></h1>
<blockquote>
<p>SELECT语句</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="err">检索单个列</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">column_name</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tablename</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">检索多个列</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">col_name1</span><span class="p">,</span><span class="w"> </span><span class="n">col_name2</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tablename</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">检索所有列</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">tablename</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">检索不同的值</span><span class="p">,</span><span class="w"> </span><span class="err">使用</span><span class="w"> </span><span class="n">DISTINCT关键词</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">col_name1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">tablename</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">注意：</span><span class="n">DISTINCT关键字用于所有的列</span><span class="err">，不仅仅是跟在其后的那一列。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">返回前五行结果</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">top</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">prod_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Products</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">使用注释</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">----注释的方法---
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">  </span><span class="cm">/* 这是注释
</span></span></span><span class="line"><span class="cl"><span class="cm">  的方法2 */</span><span class="w">
</span></span></span></code></pre></div><h1 id="排序数据">排序数据<a hidden class="anchor" aria-hidden="true" href="#排序数据">#</a></h1>
<blockquote>
<p>ORDER BY 语句</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="c1">--注意：在指定一条ORDER BY子句时，应该保证它是SELECT语句中最后一条子句--
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">col_name</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">tablename</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">col_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--多列排序--
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">col_name1</span><span class="p">,</span><span class="w"> </span><span class="n">col_name2</span><span class="p">,</span><span class="w"> </span><span class="n">col_name3</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">tablename</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">BY</span><span class="w"> </span><span class="n">col_name1</span><span class="p">,</span><span class="w"> </span><span class="n">col_name2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--降序排列--
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">col_name1</span><span class="p">,</span><span class="w"> </span><span class="n">col_name2</span><span class="p">,</span><span class="w"> </span><span class="n">col_name3</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">tablename</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">col_name1</span><span class="w"> </span><span class="k">DESC</span><span class="p">,</span><span class="w"> </span><span class="n">col_name2</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h1 id="过滤语句">过滤语句<a hidden class="anchor" aria-hidden="true" href="#过滤语句">#</a></h1>
<blockquote>
<p>WHERE 语句</p>
</blockquote>
<pre tabindex="0"><code>SELECT col_name1, col_name2 FROM tablename WHERE col_name1 = 3.49;
SELECT col_name, col_name2 FROM tablename WHERE co_name2 BETWEEN 5 AND 10;
SELECT col_name FROM tablename WHERE col_name IS NULL;

--AND语句---
SELECT col_name1, col_name2, col_name3 
FROM tablename 
WHERE col_name1=&#39;ABC&#39; AND col_name2 &lt;= 4

--OR语句---
SELECT col_name1, col_name2, col_name3 
FROM tablename 
WHERE col_name1=&#39;ABC&#39; OR col_name2 &lt;= 4

--注意：SQL在处理OR操作符前，优先处理AND操作符。使用圆括号即可解决此问题。
SELECT prod_name, prod_price
FROM Products
WHERE (vend_id = &#39;DLL01&#39; OR vend_id = ‘BRS01’) AND  prod_price &gt;= 10;

--IN语句，与OR语句相当，但是速度更快，而且可以嵌套SELECT语句
SELECT prod_name, prod_price 
FROM Products 
WHERE vend_in IN (&#39;DLL01&#39;, &#39;BSLKJL&#39;) 
ORDER BY prod_name;

--NOT语句，与&lt;&gt;类似，但是可以与IN配合使用完成更为复杂的筛选--
SELECT prod_name 
FROM Products 
WHERE NOT vend_id=&#39;DLL01&#39; 
ORDER BY prod_name;
</code></pre><h1 id="模糊过滤">模糊过滤<a hidden class="anchor" aria-hidden="true" href="#模糊过滤">#</a></h1>
<blockquote>
<p>LIKE</p>
</blockquote>
<pre tabindex="0"><code>---%表示任何字符出现任意次数,%还能匹配0个字符,注意：%不能匹配NULL;需要注意前后的空格---
SELECT prod_id, pro_name FROM Products WHERE prod_name LIKE &#39;Fish%&#39;;
SELECT prod_id, prod_name FROM Products WHERE prod_name LIKE &#39;%bean bag%&#39;;+
SELECT prod_id, prod_name FROM Products WHERE prod_name LIKE &#39;F%y&#39;;

--下划线匹配单个字符--------------
SELECT prodid, prodname 
FROM Products
WHERE prod_name LIKE &#39;__inch teddy bear&#39;;

--方括号[]匹配一个字符的可能选项，只有Access和SQL Server中才可以用--
--例如匹配J或M开头的任意cust_contact--
SELECT cust_contact
FROM Customers
WHERE cust_contact LIKE &#39;[JM]%&#39; 
ORDER BY cust_contact

--方括号通配符可以使用^来否定--
SELECT cust_contact
FROM Customers
WHERE cust_contact LIKE &#39;[^JM]%&#39; 
ORDER BY cust_contact

--上面的例子可以直接用NOT来重写--
SELECT cust_contact
FROM Customers
WHERE NOT cust_contact LIKE &#39;[JM]%&#39; 
ORDER BY cust_contact
</code></pre><ul>
<li>不要过度使用通配符。如果其他操作符能达到相同的目的，应该使用其他操作符。</li>
<li>在确实需要使用通配符时，也尽量不要把它们用在搜索模式的开始处。把通配符置于开始处，搜索起来是最慢的。</li>
<li>仔细注意通配符的位置。如果放错地方，可能不会返回想要的数据。</li>
</ul>
<h1 id="字段计算">字段计算<a hidden class="anchor" aria-hidden="true" href="#字段计算">#</a></h1>
<blockquote>
<p>+号连接字段</p>
</blockquote>
<pre tabindex="0"><code>--拼接字段--
--Access和SQL  Server使用+号。DB2、Oracle、PostgreSQL、SQLite和Open Office Base使用||。详细请参阅具体的DBMS文档。
--大多数DBMS都支持RT RIM()（正如刚才所见，它去掉字符串右边的空格）、LT RIM()（去掉字符串左边的空格）以及T RIM()（去掉字符串
左右两边的空格）。
SELECT RTRIM(vend_name)+&#39;(&#39;+RTRIM(vend_country)+&#39;)&#39; AS  vend_title
FROM Vendors
ORDER BY vend_name

--字段之间加减乘除--
SELECT prod_id, quantity, item_price, quantity*item_price AS expended_price 
FROM OrderItems 
WHERE order_num=20008;
</code></pre><h1 id="函数">函数<a hidden class="anchor" aria-hidden="true" href="#函数">#</a></h1>
<blockquote>
<p>文本函数</p>
</blockquote>
<table>
  <thead>
      <tr>
          <th>函数</th>
          <th>说 明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>LEFT()</td>
          <td>返回字符串左边的字符</td>
      </tr>
      <tr>
          <td>LENGTH()</td>
          <td>返回字符串的长度</td>
      </tr>
      <tr>
          <td>LOWER()</td>
          <td>将字符串转为小写</td>
      </tr>
      <tr>
          <td>UPPER()</td>
          <td>将字符串转为大写</td>
      </tr>
      <tr>
          <td>LTRIM()</td>
          <td>去掉字符串左边的空格</td>
      </tr>
      <tr>
          <td>RIGHT()</td>
          <td>返回字符串右边的字符</td>
      </tr>
      <tr>
          <td>RTRIM()</td>
          <td>去掉字符串右边的空格</td>
      </tr>
      <tr>
          <td>SOUNDEX()</td>
          <td>返回字符串的SOUNDEX值</td>
      </tr>
  </tbody>
</table>
<pre tabindex="0"><code>--找出发音类似的--
SELECT cust_name,cust_contact
FROM Customers
where SOUNDEX(cust_contact)=SOUNDEX(&#39;Michael Green&#39;)
</code></pre><blockquote>
<p>时间函数</p>
</blockquote>
<pre tabindex="0"><code>SELECT order_num
FROM Orders
WHERE DATEPART(yy,order_date) = 2012
</code></pre><blockquote>
<p>数值处理函数</p>
</blockquote>
<table>
  <thead>
      <tr>
          <th>函数</th>
          <th>说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>ABS()</td>
          <td>返回绝对值</td>
      </tr>
      <tr>
          <td>EXP()</td>
          <td>返回指数值</td>
      </tr>
      <tr>
          <td>PI()</td>
          <td>返回圆周率</td>
      </tr>
      <tr>
          <td>SQRT()</td>
          <td>返回平方根</td>
      </tr>
  </tbody>
</table>
<blockquote>
<p>聚集函数【AVG() COUNT()  MAX() MIN() SUM()】</p>
</blockquote>
<ul>
<li>使用COUNT (*)对表中行的数目进行计数，不管表列中包含的是空值（NULL）还是非空值。</li>
<li>使用COUNT (column)对特定列中具有值的行进行计数，忽略NULL值。</li>
</ul>
<pre tabindex="0"><code>--求平均的时候要求不重复
SELECT AVG(DISTINCT prod_price) AS avg_price
FROM Products
WHERE vend_id = &#39;DLL01&#39;;
</code></pre><h1 id="分组数据">分组数据<a hidden class="anchor" aria-hidden="true" href="#分组数据">#</a></h1>
<blockquote>
<p>GROUP BY子句和HAVING子句</p>
</blockquote>
<pre tabindex="0"><code>SELECT vend_id,COUNT(*) AS num_prods
FROM Products
GROUP BY vend_id

--结果---
vend_id	num_prods
BRS01     	3
DLL01     	4
FNG01     	2
</code></pre><ul>
<li>WHERE只能过滤行，而不是分组，分组过滤需要HAVING</li>
</ul>
<pre tabindex="0"><code>SELECT vend_id,COUNT(*) AS num_prods
FROM Products
GROUP BY vend_id
HAVING COUNT(*)&gt;2
</code></pre><h1 id="嵌套查询">嵌套查询<a hidden class="anchor" aria-hidden="true" href="#嵌套查询">#</a></h1>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="c1">---------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">cust_name</span><span class="p">,</span><span class="n">cust_contact</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">cust_id</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">cust_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">				  </span><span class="k">FROM</span><span class="w"> </span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">				  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">order_num</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">order_num</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">									  </span><span class="k">FROM</span><span class="w"> </span><span class="n">OrderItems</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">									  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">prod_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;RGAN01&#39;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">cust_name</span><span class="p">,</span><span class="w"> </span><span class="n">cust_contact</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Customers</span><span class="p">,</span><span class="w"> </span><span class="n">Orders</span><span class="p">,</span><span class="w"> </span><span class="n">OrderItems</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">Customers</span><span class="p">.</span><span class="n">cust</span><span class="w"> </span><span class="n">_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Orders</span><span class="p">.</span><span class="n">cust</span><span class="w"> </span><span class="n">_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w">  </span><span class="n">OrderItems</span><span class="p">.</span><span class="n">order_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Orders</span><span class="p">.</span><span class="n">order_num</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AND</span><span class="w">  </span><span class="n">prod_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;RGAN01&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">cust_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">cust_state</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="n">Orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">WHERE</span><span class="w"> </span><span class="n">Orders</span><span class="p">.</span><span class="n">cust_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Customers</span><span class="p">.</span><span class="n">cust_id</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">orders</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Customers</span><span class="w">		
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">cust_name</span><span class="w">		  
</span></span></span></code></pre></div><h1 id="连接表">连接表<a hidden class="anchor" aria-hidden="true" href="#连接表">#</a></h1>
<blockquote>
<p>join</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="c1">------等值连接-----------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">vend_name</span><span class="p">,</span><span class="n">prod_name</span><span class="p">,</span><span class="n">prod_price</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Vendors</span><span class="p">,</span><span class="n">Products</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">Vendors</span><span class="p">.</span><span class="n">vend_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Products</span><span class="p">.</span><span class="n">vend_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">------内连接-------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">vend_name</span><span class="p">,</span><span class="n">prod_name</span><span class="p">,</span><span class="n">prod_price</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Vendors</span><span class="w"> </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Products</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">Vendors</span><span class="p">.</span><span class="n">vend_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Products</span><span class="p">.</span><span class="n">vend_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">------外连接---------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">-</span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="err">产生的结果是</span><span class="n">AB的交集</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-</span><span class="k">LEFT</span><span class="w"> </span><span class="p">[</span><span class="k">OUTER</span><span class="p">]</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="err">产生表</span><span class="n">A的完全集</span><span class="err">，而</span><span class="n">B表中匹配的则有值</span><span class="err">，没有匹配的则以</span><span class="n">null值取代</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-</span><span class="k">RIGHT</span><span class="w"> </span><span class="p">[</span><span class="k">OUTER</span><span class="p">]</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="err">产生表</span><span class="n">B的完全集</span><span class="err">，而</span><span class="n">A表中匹配的则有值</span><span class="err">，没有匹配的则以</span><span class="n">null值取代</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">-</span><span class="k">FULL</span><span class="w"> </span><span class="p">[</span><span class="k">OUTER</span><span class="p">]</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="err">产生</span><span class="n">A和B的并集</span><span class="err">。对于没有匹配的记录，则会以</span><span class="n">null做为值</span><span class="err">。</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">vend_name</span><span class="p">,</span><span class="n">prod_name</span><span class="p">,</span><span class="n">prod_price</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Vendors</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Products</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">Vendors</span><span class="p">.</span><span class="n">vend_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Products</span><span class="p">.</span><span class="n">vend_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">vend_name</span><span class="p">,</span><span class="n">prod_name</span><span class="p">,</span><span class="n">prod_price</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Vendors</span><span class="w"> </span><span class="k">RIGHT</span><span class="w"> </span><span class="k">OUTER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Products</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">Vendors</span><span class="p">.</span><span class="n">vend_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Products</span><span class="p">.</span><span class="n">vend_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-------表别名-------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">cust_name</span><span class="p">,</span><span class="n">cust_contact</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Customers</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">C</span><span class="w"> </span><span class="p">,</span><span class="n">Orders</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">O</span><span class="p">,</span><span class="n">OrderItems</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">OI</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w">  </span><span class="k">C</span><span class="p">.</span><span class="n">cust_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">O</span><span class="p">.</span><span class="n">cust_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">OI</span><span class="p">.</span><span class="n">order_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">O</span><span class="p">.</span><span class="n">order_num</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">prod_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;RGAN01&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><pre tabindex="0"><code>--这个例子使用左外部联结来包含所有顾客，甚至包含那些没有任何订单的顾客。
SELECT Customers.cust_id,
COUNT(Orders.order_num) AS  num_ord
FROM Cust omers LEFT OUTER JOIN  Orders
ON  Customers.cust _id = Orders.cust _id
GROUP BY Customers.cust _id;
</code></pre><h1 id="组合查询">组合查询<a hidden class="anchor" aria-hidden="true" href="#组合查询">#</a></h1>
<blockquote>
<p>UNION函数
直接在两条SELECT语句之间，将结果合并在一起，类似在WHERE中使用OR函数，UNION会默认去除重复数据，UNION ALL不去除重复数据。ORDER BY函数必须放在最后一个SELECT语句中，并作用于最后的合并结果</p>
</blockquote>
<h1 id="插入数据">插入数据<a hidden class="anchor" aria-hidden="true" href="#插入数据">#</a></h1>
<blockquote>
<p>INSERT INTO 按照列名来可以重复使用，可以只插入部分数据，</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="c1">------插入一行数据------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">Customers</span><span class="p">(</span><span class="n">cust_id</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">cust_name</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">cust_city</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">cust_state</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">cust_zip</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">cust_country</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">cust_contact</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">cust_email</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;1000000001&#39;</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="s1">&#39;Village Toys&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;200 Maple Lane&#39;</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;Detroit&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;MI&#39;</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;USA&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;John Smith&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="s1">&#39;sales@villagetoys.com&#39;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="c1">-----插入SELECT结果，只关注顺序，不关注筛选出的字段名-------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">Customers</span><span class="p">(</span><span class="n">cust_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                      </span><span class="n">cust_contact</span><span class="w"> </span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                      </span><span class="n">cust_email</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                      </span><span class="n">cust_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                      </span><span class="n">cust_address</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                      </span><span class="n">cust_city</span><span class="w"> </span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                      </span><span class="n">cust_state</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                      </span><span class="n">cust_zip</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                      </span><span class="n">cust_country</span><span class="w"> </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">cust_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">cust_contact</span><span class="w"> </span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">cust_email</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">cust_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">cust_address</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">cust_city</span><span class="w"> </span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">cust_state</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">cust_zip</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="n">cust_country</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">CustNew</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="c1">-----从一个表复制到另一个表-------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INTO</span><span class="w"> </span><span class="n">CustCopy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Customers</span><span class="w">
</span></span></span></code></pre></div><h1 id="更新删除数据">更新删除数据<a hidden class="anchor" aria-hidden="true" href="#更新删除数据">#</a></h1>
<blockquote>
<p>UPDATE  DELETE</p>
</blockquote>
<pre tabindex="0"><code>----更新指定行-------------
UPDATE Customers
SET cust_contact  = &#39;Sam Roberts&#39;,
    cust_email = &#39;sam@toyland.com&#39;
WHERE cust_id = &#39;1000000006&#39;;
------删除指定行--------
DELETE FROM Cust omers
WHERE cust_id = &#39;1000000006&#39;;
--DELETE只能删除行，删除列则用update
--删除表中的所有数据TRUNCATE TABLE速度更快
</code></pre><h1 id="创建和操纵类">创建和操纵类<a hidden class="anchor" aria-hidden="true" href="#创建和操纵类">#</a></h1>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="c1">----创建表-------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Products</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">prod_id</span><span class="w">    </span><span class="nb">char</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w">      </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">vend_id</span><span class="w">    </span><span class="nb">char</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w">      </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">prod_name</span><span class="w">  </span><span class="nb">char</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w">     </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">prod_price</span><span class="w"> </span><span class="nb">decimal</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">prod_desc</span><span class="w">  </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span><span class="w"> </span><span class="k">NULL</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><pre tabindex="0"><code>------更新表---------
ALTER  TABLE Vendos
ADD vend_phone CHAR(20);
ALTER  TABLE Vendos
DROP COULUMN vend_phone;
</code></pre><pre tabindex="0"><code>----删除表-------
DROP TABLE CustCopy ;
</code></pre><ul>
<li>每个DBMS对表重命名的支持有所不同。对于这个操作，不存在严格的标准。DB2、MariaDB、My SQL、Oracle和PostgreSQL用户使
用RENAME语句，SQL  Server用户使用sp_rename存储过程，SQLite用户使用ALTER TABLE语句。</li>
</ul>
<h1 id="使用视图">使用视图<a hidden class="anchor" aria-hidden="true" href="#使用视图">#</a></h1>
<blockquote>
<p>CREATE  VIEW viewname</p>
</blockquote>
<ul>
<li>视图是虚拟的表</li>
<li>视图可以重用SQL语句</li>
<li>可以简化复杂SQL操作，在编写查询后，可以方便重用它，而不必知道其查询的细节</li>
<li>使用表的一部分而不是整个表</li>
<li>保护数据</li>
<li>更改数据的表现格式</li>
<li>视图不包含数据，每次使用的时候都会重新检索，因此如果特别复杂的SQL查询性能会下降的很厉害。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="c1">---创建视图------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">ProductCustomers</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">cust_name</span><span class="p">,</span><span class="n">cust_contact</span><span class="p">,</span><span class="n">prod_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Customers</span><span class="p">,</span><span class="n">Orders</span><span class="p">,</span><span class="n">OrderItems</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">Customers</span><span class="p">.</span><span class="n">cust_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Orders</span><span class="p">.</span><span class="n">cust_id</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">OrderItems</span><span class="p">.</span><span class="n">order_item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Orders</span><span class="p">.</span><span class="n">order_num</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">---查看视图-----------
</span></span></span><span class="line"><span class="cl"><span class="c1">--这条语句创建一个名为ProductCustomers的视图，它联结三个表，返回已订购了任意产品的所有顾客的列表。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ProductCustomers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--检索订购了产品RGA N01的顾客
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ProductCustomers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">prod_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;RGAN01&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">----用视图重新格式化检索数据------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">VendorLocations</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">RTRIM</span><span class="p">(</span><span class="n">vend_name</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="n">RTRIM</span><span class="p">(</span><span class="n">vend_country</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w">  </span><span class="n">vend_title</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Vendors</span><span class="w">
</span></span></span></code></pre></div><h1 id="使用存储过程批处理">使用存储过程(批处理)<a hidden class="anchor" aria-hidden="true" href="#使用存储过程批处理">#</a></h1>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">PROCEDURE</span><span class="w"> </span><span class="n">MailingListCount</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">cnt</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">@</span><span class="n">cnt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">Customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="n">cust_email</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURN</span><span class="w"> </span><span class="o">@</span><span class="n">cnt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">DECLARE</span><span class="w"> </span><span class="o">@</span><span class="n">ReturnValue</span><span class="w"> </span><span class="nb">INT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">EXECUTE</span><span class="w"> </span><span class="o">@</span><span class="n">ReturnValue</span><span class="o">=</span><span class="n">MailingListCount</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">@</span><span class="n">ReturnValue</span><span class="w">
</span></span></span></code></pre></div><ul>
<li>在Orders表中插入一个新订单</li>
</ul>
<pre tabindex="0"><code>CREATE PROCEDURE NewOrder @cust_id CHAR(10)
AS
--Declare variable for order number
DECLARE @order_num INTEGER
--Get current highest order number
SELECT @order_num = MAX(order_num)
FROM Orders
--Determine next order number
SELECT @order_num = @order_num+1
--Insert new order
INSERT INTO Orders(order_num,order_date,cust_id)
VALUES(@order_num,GETDATE(),@cust_id)
--Return order number
RETURN @order_num;
</code></pre><ul>
<li>此存储过程在O rders表中创建一个新订单。它只有一个参数，即下订单顾客的I D。订单号和订单日期这两列在存储过程中自动生成。代码首先声明一个局部变量来存储订单号。接着，检索当前最大订单号（使用MA X()函数）并增加1（使用SELECT 语句）。然后用INSERT 语句插入由新生成的订单号、当前系统日期（用GET DA T E()函数检索）和传递的顾客I D组成的订单。最后，用RET U RN @order_num返回订单号（处理订单物品需要它）。请注意，此代码加了注释，在编写存储过程时应该多加注释</li>
</ul>
<pre tabindex="0"><code>CREATE PROCEDURE NewOrder @cust_id CHAR(10)
AS
--Insert new order
INSERT INFO Orders(cust_id)
VALUES(@cust_id)
--Return order number
SELECT order_num = @@IDENTITY
</code></pre><ul>
<li>此存储过程也在Orders表中创建一个新订单。这次由DBMS生成订单号。大多数DBMS都支持这种功能；SQL  Serv er中称这些自动增量的列为标识字段（i den t i t y   f i el d），而其他DBMS称之为自动编号（au t o  n u mber）或序列（sequ en ce）。传递给此过程的参数也是一个，即下订单的顾客ID。订单号和订单日期没有给出，DBMS对日期使用默认值（GETDATE()函数），订单号自动生成。怎样才能得到这个自动生成的I D？在SQL  Serv er上可在全局变量@@IDENT ITY 中得到，它返回到调用程序（这里使用SELECT 语句）。</li>
</ul>
<h1 id="管理事务处理transaction-processing">管理事务处理（transaction processing）<a hidden class="anchor" aria-hidden="true" href="#管理事务处理transaction-processing">#</a></h1>
<blockquote>
<p>COMMIT 和ROLLBACK语句</p>
</blockquote>
<ul>
<li>事务处理是通过确保成批SQL操作要么完全执行，要么完全不执行</li>
<li>在使用事务处理时，有几个反复出现的关键词。下面是关于事务处理需要知道的几个术语：</li>
</ul>
<ol>
<li>事务（transaction ）指一组SQL语句；</li>
<li>回退（rollback）指撤销指定SQL语句的过程；</li>
<li>提交（commit）指将未存储的SQL语句结果写入数据库表；</li>
<li>保留点（savepoint）指事务处理中设置的临时占位符（pl aceholder），可以对它发布回退（与回退整个事务处理不同）。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="n">BEGINT</span><span class="w"> </span><span class="n">RANSACTION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">Customers</span><span class="p">(</span><span class="n">cust_id</span><span class="p">,</span><span class="n">cust_name</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;1000000010&#39;</span><span class="p">,</span><span class="s1">&#39;ToysEmporium&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--定义保存点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">SAVE</span><span class="w"> </span><span class="k">TRANSACTION</span><span class="w"> </span><span class="n">StartOrder</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">Orders</span><span class="p">(</span><span class="n">order_num</span><span class="p">,</span><span class="n">order_date</span><span class="p">,</span><span class="n">cust_id</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="p">(</span><span class="mi">20100</span><span class="p">,</span><span class="s1">&#39;2001/12/1&#39;</span><span class="p">,</span><span class="s1">&#39;1000000010&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--若执行不成功就回退到保存点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">IF</span><span class="w"> </span><span class="o">@@</span><span class="n">ERROR</span><span class="o">&lt;&gt;</span><span class="mi">0</span><span class="w"> </span><span class="k">ROLLBACK</span><span class="w"> </span><span class="k">TRANSACTION</span><span class="w"> </span><span class="n">StartOrder</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">OrderItems</span><span class="p">(</span><span class="n">order_num</span><span class="p">,</span><span class="n">order_item</span><span class="p">,</span><span class="n">prod_id</span><span class="p">,</span><span class="n">quantity</span><span class="p">,</span><span class="n">item_price</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="p">(</span><span class="mi">20100</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;BR01&#39;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">5</span><span class="p">.</span><span class="mi">49</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">IF</span><span class="w"> </span><span class="o">@@</span><span class="n">ERROR</span><span class="o">&lt;&gt;</span><span class="mi">0</span><span class="w"> </span><span class="k">ROLLBACK</span><span class="w"> </span><span class="k">TRANSACTION</span><span class="w"> </span><span class="n">StartOrder</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">OrderItems</span><span class="p">(</span><span class="n">order_num</span><span class="p">,</span><span class="n">order_item</span><span class="p">,</span><span class="n">prod_id</span><span class="p">,</span><span class="n">quantity</span><span class="p">,</span><span class="n">item_price</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="p">(</span><span class="mi">20100</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;BR03&#39;</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">10</span><span class="p">.</span><span class="mi">99</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">IF</span><span class="w"> </span><span class="o">@@</span><span class="n">ERROR</span><span class="o">&lt;&gt;</span><span class="mi">0</span><span class="w"> </span><span class="k">ROLLBACK</span><span class="w"> </span><span class="k">TRANSACTION</span><span class="w"> </span><span class="n">StartOrder</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">COMMIT</span><span class="w"> </span><span class="k">TRANSACTION</span><span class="w">
</span></span></span></code></pre></div><h1 id="使用游标">使用游标<a hidden class="anchor" aria-hidden="true" href="#使用游标">#</a></h1>
<pre tabindex="0"><code>--创建游标
--在上面两个版本中，DECLA RE语句用来定义和命名游标，这里为CustCursor。SELECT 语句定义一个包含没有电子邮件地址（NU LL值）的所有
顾客的游标。
DECLARE CustCursor CURSOR
FOR
SELECT * FROM Customers
WHERE cust_email is NULL
---------------------
DECLARE @cust_id CHAR(10),
        @cust_name CHAR(50),
        @cust_address CHAR(50),
        @cust_city CHAR(50),
        @cust_state CHAR(5),
        @cust_zip CHAR(10),
        @cust_country CHAR(50),
        @cust_contact CHAR(50),
        @cust_email CHAR(255)
OPEN CustCursor
FETCH NEXT FROM CustCursor
INTO @cust_id,@cust_name,@cust_address,
     @cust_city,@cust_state,@cust_zip,
     @cust_country,@cust_contact,@cust_email
WHILE @@FETCH_STATUS=0
BEGIN
    --占位符
FETCH NEXT FROM CustCursor
	INTO @cust_id,@cust_name,@cust_address,
         @cust_city,@cust_state,@cust_zip,
         @cust_country,@cust_contact,@cust_email
END
CLOSE CustCursor
DEALLOCATE  CustCursor
</code></pre><ul>
<li>在此例中，为每个检索出的列声明一个变量，FET CH语句检索一行并保存值到这些变量中。使用WHILE循环处理每一行，条件WHILE @@FET CH_ST A T U S = 0在取不出更多的行时终止处理（退出循环）。这个例子也不进行具体的处理，实际代码中，应该用具体的处理代码替换其中的…占位符。</li>
</ul>
<h1 id="高级sql特性">高级SQL特性<a hidden class="anchor" aria-hidden="true" href="#高级sql特性">#</a></h1>
<h2 id="约束">约束<a hidden class="anchor" aria-hidden="true" href="#约束">#</a></h2>
<h2 id="索引">索引<a hidden class="anchor" aria-hidden="true" href="#索引">#</a></h2>
<h2 id="触发器">触发器<a hidden class="anchor" aria-hidden="true" href="#触发器">#</a></h2>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/data-analyst/">Data Analyst</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/%E5%9C%B0%E5%9B%BE%E5%AF%BC%E8%88%AA%E4%BA%A7%E5%93%81%E5%88%86%E6%9E%90%E6%8A%A5%E5%91%8A/">
    <span class="title">« Prev</span>
    <br>
    <span>地图导航产品分析报告</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="http://localhost:1313/">lula&#39;s blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
