<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>CELPIP12 - AI-Powered CELPIP Writing Practice Platform | lula&#39;s blog</title>
<meta name="keywords" content="CELPIP, AI, Language Learning, OpenAI, Next.js, Full-Stack">
<meta name="description" content="An AI-driven CELPIP writing practice platform offering intelligent scoring, real-time feedback, and sample answer comparison to help Canadian immigration candidates prepare effectively">
<meta name="author" content="lula">
<link rel="canonical" href="http://localhost:1313/projects/celpip-practice/">
<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <meta name="referrer" content="no-referrer-when-downgrade">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk&#43;4bvpN&#43;sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/projects/celpip-practice/">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/zh/projects/celpip-practice/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-WMC06JHFDG"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-WMC06JHFDG');
        }
      </script><meta property="og:url" content="http://localhost:1313/projects/celpip-practice/">
  <meta property="og:site_name" content="lula&#39;s blog">
  <meta property="og:title" content="CELPIP12 - AI-Powered CELPIP Writing Practice Platform">
  <meta property="og:description" content="An AI-driven CELPIP writing practice platform offering intelligent scoring, real-time feedback, and sample answer comparison to help Canadian immigration candidates prepare effectively">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="projects">
    <meta property="article:published_time" content="2025-08-13T12:00:00+00:00">
    <meta property="article:modified_time" content="2025-08-13T12:00:00+00:00">
    <meta property="article:tag" content="CELPIP">
    <meta property="article:tag" content="AI">
    <meta property="article:tag" content="Language Learning">
    <meta property="article:tag" content="OpenAI">
    <meta property="article:tag" content="Next.js">
    <meta property="article:tag" content="Full-Stack">
    <meta property="og:image" content="http://localhost:1313/images/celpip_preview.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/images/celpip_preview.png">
<meta name="twitter:title" content="CELPIP12 - AI-Powered CELPIP Writing Practice Platform">
<meta name="twitter:description" content="An AI-driven CELPIP writing practice platform offering intelligent scoring, real-time feedback, and sample answer comparison to help Canadian immigration candidates prepare effectively">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "My Projects",
      "item": "http://localhost:1313/projects/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "CELPIP12 - AI-Powered CELPIP Writing Practice Platform",
      "item": "http://localhost:1313/projects/celpip-practice/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CELPIP12 - AI-Powered CELPIP Writing Practice Platform",
  "name": "CELPIP12 - AI-Powered CELPIP Writing Practice Platform",
  "description": "An AI-driven CELPIP writing practice platform offering intelligent scoring, real-time feedback, and sample answer comparison to help Canadian immigration candidates prepare effectively",
  "keywords": [
    "CELPIP", "AI", "Language Learning", "OpenAI", "Next.js", "Full-Stack"
  ],
  "articleBody": "Why CELPIP (Canadian English Language Proficiency Index Program) is an officially recognized English proficiency test by the Canadian government, crucial for those seeking to immigrate to Canada. However, the market lacks high-quality CELPIP writing practice tools, with most learners relying on expensive training courses or self-practice without feedback.\nAs a technology developer, I recognized the immense potential of AI in language learning and decided to build an intelligent CELPIP writing practice platform that provides learners with instant, professional writing feedback.\nWhat CELPIP12 is a full-featured AI-driven writing practice platform that offers:\nü§ñ Intelligent AI Scoring System Professional scoring based on OpenAI o1-mini model Strict adherence to CELPIP official scoring standards (1-12 scale) Four-dimensional assessment: Content \u0026 Coherence, Vocabulary, Readability, Task Fulfillment üìù Real-time Writing Feedback Word-level grammar and expression suggestions Smart highlighting of areas needing improvement Detailed improvement suggestions and explanations üìö Official Sample Answer Comparison 90+ official sample answers covering different score ranges Smart detection of question source with automatic sample matching Score range filtering to study writing techniques at different proficiency levels üéØ Professional Question Bank System 46+ official practice questions Complete coverage of Task A (Email Writing) and Task B (Survey Response) Smart sorting and search functionality üë§ User Management System Secure authentication system with Clerk integration Personalized learning progress tracking Writing history records and performance analysis How Technical Architecture Frontend Tech Stack Next.js 14: Modern React framework with App Router TypeScript: Fully type-safe development experience Tailwind CSS: Responsive UI design Slate.js: Rich text editor supporting real-time correction highlighting Backend \u0026 Services API Routes: Next.js server-side API handling AI evaluation and data management OpenAI Integration: o1-mini model API integration for professional language assessment Vercel Postgres: Cloud database storing user data and learning records Clerk Authentication: Enterprise-grade user authentication and management Core Algorithm Design Dual-Phase AI Assessment System:\n// Phase 1: Comprehensive Scoring const scoreResponse = await openai.chat.completions.create({ model: \"o1-mini\", messages: [{ role: \"user\", content: celpipTeacherPrompt + userEssay }] }); // Phase 2: Detailed Correction Suggestions const correctionResponse = await openai.chat.completions.create({ model: \"o1-mini\", messages: [{ role: \"user\", content: celpipCommentsPrompt + userEssay }] }); Intelligent Caching Mechanism:\nGlobal credit state management avoiding redundant API calls Automated user initialization enhancing new user experience 30-second caching mechanism balancing performance and data freshness System Design Highlights 1. User Experience Optimization Proactive Initialization Architecture: Automatic account initialization upon user login, eliminating error prompts Real-time Saving: Auto-save writing content preventing accidental loss Responsive Design: Cross-device compatibility providing consistent learning experience 2. Data Architecture Design -- Users Table CREATE TABLE users ( id TEXT PRIMARY KEY, email TEXT, usage_count INTEGER DEFAULT 30 ); -- Score History Table CREATE TABLE score_history ( id SERIAL PRIMARY KEY, user_id TEXT, question TEXT, essay TEXT, ai_response JSONB, ai_corrections JSONB, created_at TIMESTAMP DEFAULT NOW() ); 3. Error Handling \u0026 Retry Mechanism Exponential backoff retry strategy ensuring AI API call stability Graceful error recovery improving user experience Detailed error logging facilitating issue diagnosis Technical Challenges \u0026 Solutions Challenge 1: AI Scoring Accuracy and Consistency Solution:\nCarefully crafted prompt engineering ensuring AI output aligns with CELPIP scoring standards Extensive testing and optimization guaranteeing scoring stability JSON formatted output ensuring consistent data structure Challenge 2: Complex User State Management Solution:\nContext-based global state management Single source of truth architecture preventing state synchronization issues Intelligent caching strategy reducing unnecessary API calls Challenge 3: Rich Text Editor Correction Highlighting Solution:\nCustom Slate.js renderer Character index-based precise positioning Dynamic styling application achieving real-time highlighting effects Project Structure celpip/ ‚îú‚îÄ‚îÄ src/ ‚îÇ ‚îú‚îÄ‚îÄ app/ # Next.js App Router ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ api/ # API Routes ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ writing/ # Writing Practice Page ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ history/ # History Page ‚îÇ ‚îú‚îÄ‚îÄ components/ # React Components ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ Essay.tsx # Core Writing Editor ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ Score.tsx # Score Display Component ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ SampleAnswersPanel.tsx # Sample Comparison Panel ‚îÇ ‚îú‚îÄ‚îÄ contexts/ # React Context ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ EssayContext.tsx ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ UserContext.tsx ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ LanguageContext.tsx ‚îÇ ‚îú‚îÄ‚îÄ hooks/ # Custom Hooks ‚îÇ ‚îú‚îÄ‚îÄ lib/ # Utilities and API Wrappers ‚îÇ ‚îî‚îÄ‚îÄ data/ # Question Bank and Sample Data ‚îú‚îÄ‚îÄ public/ # Static Assets ‚îî‚îÄ‚îÄ vercel.json # Deployment Configuration Core Feature Implementation Intelligent Scoring Engine Based on OpenAI o1-mini model, I designed a dual-phase assessment system:\nOverall Scoring: Comprehensive 1-12 scale evaluation following CELPIP official standards Detailed Corrections: Word-by-word analysis providing specific improvement suggestions and grammar corrections Smart Sample Matching Automatic detection of user-selected questions Matching relevant content from 90+ official samples Score range filtering to study writing techniques at different proficiency levels Personalized Learning Path Recording user writing history and performance changes Providing personalized learning recommendations Multi-language interface support (Chinese/English switching) Deployment \u0026 Operations Production Environment Deployment Vercel: Zero-configuration deployment with automatic CI/CD Edge Computing: Global CDN acceleration reducing access latency Database: Vercel Postgres with auto-scaling capabilities Monitoring: Built-in error tracking and performance monitoring Security Assurance Clerk Authentication: Enterprise-grade user authentication and permission management API Security: All sensitive operations require user authentication Data Encryption: End-to-end encryption for user data transmission and storage Project Outcomes Technical Metrics Bundle Size: Homepage 6.68KB, Writing page 80.8KB Performance: Lighthouse score 95+ Availability: 99.9% uptime Response Time: AI scoring average 15-30 seconds User Experience Intuitive Interface: Three-column layout with clear functional areas Instant Feedback: Real-time display of writing suggestions and scoring results Learning Effectiveness: Detailed improvement suggestions and sample comparisons Future Roadmap Feature Expansion Speaking practice module integration Additional AI model support (Claude, Gemini, etc.) Learning analytics dashboard Community features and study groups Technical Optimization Server-side rendering optimization Offline mode support Mobile app development Multi-language AI assessment support Technical Value This project demonstrates my technical capabilities in the following areas:\nFull-Stack Development: Complete implementation from frontend UI to backend API AI Integration: Deep integration of OpenAI API and prompt engineering User Experience Design: Simplified expression of complex functionality System Architecture: Scalable modular design Performance Optimization: Caching strategies and state management optimization Production Deployment: Modern DevOps practices This project not only addresses real learning needs but also fully demonstrates modern web development best practices and the practical application value of AI technology.\nProfessional Skills Demonstrated Frontend Development React Ecosystem: Advanced usage of React 18, custom hooks, context management TypeScript: Comprehensive type safety implementation across the entire codebase UI/UX Design: Responsive design with Tailwind CSS, intuitive user interfaces State Management: Complex application state architecture with performance optimization Backend Development API Design: RESTful API design with proper error handling and validation Database Design: Efficient schema design and query optimization Authentication: Secure user management with industry-standard practices Performance: Caching strategies, connection pooling, and response optimization AI/ML Integration Prompt Engineering: Sophisticated prompt design for consistent AI responses Model Integration: Production-ready OpenAI API integration with error handling Data Processing: Complex JSON parsing and formatting for AI responses Performance Tuning: Optimized API usage patterns and response caching DevOps \u0026 Production Deployment: Modern CI/CD pipelines with Vercel Monitoring: Error tracking, performance monitoring, and analytics Scalability: Cloud-native architecture ready for horizontal scaling Security: Production-grade security practices and data protection Open Source Contribution The project is open-sourced on GitHub, welcoming community contributions and feedback. All code follows best practices with comprehensive documentation and test cases, providing valuable learning resources for other developers.\nImpact \u0026 Results Problem Solving: Addressed a real market gap in CELPIP preparation tools Technical Innovation: Novel application of AI in language learning assessment User Value: Provided accessible, high-quality language learning assistance Code Quality: Production-ready codebase demonstrating professional development standards This project represents a comprehensive demonstration of modern full-stack development capabilities, AI integration expertise, and user-centered design principles‚Äîall essential skills for senior developer positions in today‚Äôs technology landscape.\n",
  "wordCount" : "1251",
  "inLanguage": "en",
  "image":"http://localhost:1313/images/celpip_preview.png","datePublished": "2025-08-13T12:00:00Z",
  "dateModified": "2025-08-13T12:00:00Z",
  "author":{
    "@type": "Person",
    "name": "lula"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/projects/celpip-practice/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "lula's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="lula&#39;s blog (Alt + H)">lula&#39;s blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="http://localhost:1313/zh/" title="‰∏≠Êñá"
                            aria-label="‰∏≠Êñá">‰∏≠Êñá</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/projects/" title="Projects">
                    <span>Projects</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;¬ª&nbsp;<a href="http://localhost:1313/projects/">My Projects</a></div>
    <h1 class="post-title entry-hint-parent">
      CELPIP12 - AI-Powered CELPIP Writing Practice Platform
    </h1>
    <div class="post-description">
      An AI-driven CELPIP writing practice platform offering intelligent scoring, real-time feedback, and sample answer comparison to help Canadian immigration candidates prepare effectively
    </div>
    <div class="post-meta"><span title='2025-08-13 12:00:00 +0000 +0000'>August 13, 2025</span>&nbsp;¬∑&nbsp;lula&nbsp;|&nbsp;Translations:
<ul class="i18n_list">
    <li>
        <a href="http://localhost:1313/zh/projects/celpip-practice/">‰∏≠Êñá</a>
    </li>
</ul>

</div>
  </header> 
<figure class="entry-cover"><img loading="eager" src="http://localhost:1313/images/celpip_preview.png" alt="CELPIP12 Writing Practice Platform Interface">
        <p>CELPIP12 Writing Practice Platform Interface</p>
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#why">Why</a></li>
    <li><a href="#what">What</a>
      <ul>
        <li><a href="#-intelligent-ai-scoring-system">ü§ñ Intelligent AI Scoring System</a></li>
        <li><a href="#-real-time-writing-feedback">üìù Real-time Writing Feedback</a></li>
        <li><a href="#-official-sample-answer-comparison">üìö Official Sample Answer Comparison</a></li>
        <li><a href="#-professional-question-bank-system">üéØ Professional Question Bank System</a></li>
        <li><a href="#-user-management-system">üë§ User Management System</a></li>
      </ul>
    </li>
    <li><a href="#how">How</a>
      <ul>
        <li><a href="#technical-architecture">Technical Architecture</a></li>
        <li><a href="#system-design-highlights">System Design Highlights</a></li>
      </ul>
    </li>
    <li><a href="#technical-challenges--solutions">Technical Challenges &amp; Solutions</a>
      <ul>
        <li><a href="#challenge-1-ai-scoring-accuracy-and-consistency">Challenge 1: AI Scoring Accuracy and Consistency</a></li>
        <li><a href="#challenge-2-complex-user-state-management">Challenge 2: Complex User State Management</a></li>
        <li><a href="#challenge-3-rich-text-editor-correction-highlighting">Challenge 3: Rich Text Editor Correction Highlighting</a></li>
      </ul>
    </li>
    <li><a href="#project-structure">Project Structure</a></li>
    <li><a href="#core-feature-implementation">Core Feature Implementation</a>
      <ul>
        <li><a href="#intelligent-scoring-engine">Intelligent Scoring Engine</a></li>
        <li><a href="#smart-sample-matching">Smart Sample Matching</a></li>
        <li><a href="#personalized-learning-path">Personalized Learning Path</a></li>
      </ul>
    </li>
    <li><a href="#deployment--operations">Deployment &amp; Operations</a>
      <ul>
        <li><a href="#production-environment-deployment">Production Environment Deployment</a></li>
        <li><a href="#security-assurance">Security Assurance</a></li>
      </ul>
    </li>
    <li><a href="#project-outcomes">Project Outcomes</a>
      <ul>
        <li><a href="#technical-metrics">Technical Metrics</a></li>
        <li><a href="#user-experience">User Experience</a></li>
      </ul>
    </li>
    <li><a href="#future-roadmap">Future Roadmap</a>
      <ul>
        <li><a href="#feature-expansion">Feature Expansion</a></li>
        <li><a href="#technical-optimization">Technical Optimization</a></li>
      </ul>
    </li>
    <li><a href="#technical-value">Technical Value</a></li>
    <li><a href="#professional-skills-demonstrated">Professional Skills Demonstrated</a>
      <ul>
        <li><a href="#frontend-development">Frontend Development</a></li>
        <li><a href="#backend-development">Backend Development</a></li>
        <li><a href="#aiml-integration">AI/ML Integration</a></li>
        <li><a href="#devops--production">DevOps &amp; Production</a></li>
      </ul>
    </li>
    <li><a href="#open-source-contribution">Open Source Contribution</a></li>
    <li><a href="#impact--results">Impact &amp; Results</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="why">Why<a hidden class="anchor" aria-hidden="true" href="#why">#</a></h2>
<p>CELPIP (Canadian English Language Proficiency Index Program) is an officially recognized English proficiency test by the Canadian government, crucial for those seeking to immigrate to Canada. However, the market lacks high-quality CELPIP writing practice tools, with most learners relying on expensive training courses or self-practice without feedback.</p>
<p>As a technology developer, I recognized the immense potential of AI in language learning and decided to build an intelligent CELPIP writing practice platform that provides learners with instant, professional writing feedback.</p>
<h2 id="what">What<a hidden class="anchor" aria-hidden="true" href="#what">#</a></h2>
<p>CELPIP12 is a full-featured AI-driven writing practice platform that offers:</p>
<h3 id="-intelligent-ai-scoring-system">ü§ñ Intelligent AI Scoring System<a hidden class="anchor" aria-hidden="true" href="#-intelligent-ai-scoring-system">#</a></h3>
<ul>
<li>Professional scoring based on OpenAI o1-mini model</li>
<li>Strict adherence to CELPIP official scoring standards (1-12 scale)</li>
<li>Four-dimensional assessment: Content &amp; Coherence, Vocabulary, Readability, Task Fulfillment</li>
</ul>
<h3 id="-real-time-writing-feedback">üìù Real-time Writing Feedback<a hidden class="anchor" aria-hidden="true" href="#-real-time-writing-feedback">#</a></h3>
<ul>
<li>Word-level grammar and expression suggestions</li>
<li>Smart highlighting of areas needing improvement</li>
<li>Detailed improvement suggestions and explanations</li>
</ul>
<h3 id="-official-sample-answer-comparison">üìö Official Sample Answer Comparison<a hidden class="anchor" aria-hidden="true" href="#-official-sample-answer-comparison">#</a></h3>
<ul>
<li>90+ official sample answers covering different score ranges</li>
<li>Smart detection of question source with automatic sample matching</li>
<li>Score range filtering to study writing techniques at different proficiency levels</li>
</ul>
<h3 id="-professional-question-bank-system">üéØ Professional Question Bank System<a hidden class="anchor" aria-hidden="true" href="#-professional-question-bank-system">#</a></h3>
<ul>
<li>46+ official practice questions</li>
<li>Complete coverage of Task A (Email Writing) and Task B (Survey Response)</li>
<li>Smart sorting and search functionality</li>
</ul>
<h3 id="-user-management-system">üë§ User Management System<a hidden class="anchor" aria-hidden="true" href="#-user-management-system">#</a></h3>
<ul>
<li>Secure authentication system with Clerk integration</li>
<li>Personalized learning progress tracking</li>
<li>Writing history records and performance analysis</li>
</ul>
<h2 id="how">How<a hidden class="anchor" aria-hidden="true" href="#how">#</a></h2>
<h3 id="technical-architecture">Technical Architecture<a hidden class="anchor" aria-hidden="true" href="#technical-architecture">#</a></h3>
<h4 id="frontend-tech-stack">Frontend Tech Stack<a hidden class="anchor" aria-hidden="true" href="#frontend-tech-stack">#</a></h4>
<ul>
<li><strong>Next.js 14</strong>: Modern React framework with App Router</li>
<li><strong>TypeScript</strong>: Fully type-safe development experience</li>
<li><strong>Tailwind CSS</strong>: Responsive UI design</li>
<li><strong>Slate.js</strong>: Rich text editor supporting real-time correction highlighting</li>
</ul>
<h4 id="backend--services">Backend &amp; Services<a hidden class="anchor" aria-hidden="true" href="#backend--services">#</a></h4>
<ul>
<li><strong>API Routes</strong>: Next.js server-side API handling AI evaluation and data management</li>
<li><strong>OpenAI Integration</strong>: o1-mini model API integration for professional language assessment</li>
<li><strong>Vercel Postgres</strong>: Cloud database storing user data and learning records</li>
<li><strong>Clerk Authentication</strong>: Enterprise-grade user authentication and management</li>
</ul>
<h4 id="core-algorithm-design">Core Algorithm Design<a hidden class="anchor" aria-hidden="true" href="#core-algorithm-design">#</a></h4>
<p><strong>Dual-Phase AI Assessment System</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="c1">// Phase 1: Comprehensive Scoring
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">scoreResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">openai</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">completions</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">model</span><span class="o">:</span> <span class="s2">&#34;o1-mini&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">messages</span><span class="o">:</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">role</span><span class="o">:</span> <span class="s2">&#34;user&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="nx">content</span>: <span class="kt">celpipTeacherPrompt</span> <span class="o">+</span> <span class="nx">userEssay</span>
</span></span><span class="line"><span class="cl">  <span class="p">}]</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Phase 2: Detailed Correction Suggestions
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">correctionResponse</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">openai</span><span class="p">.</span><span class="nx">chat</span><span class="p">.</span><span class="nx">completions</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">model</span><span class="o">:</span> <span class="s2">&#34;o1-mini&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">messages</span><span class="o">:</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">role</span><span class="o">:</span> <span class="s2">&#34;user&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">content</span>: <span class="kt">celpipCommentsPrompt</span> <span class="o">+</span> <span class="nx">userEssay</span>
</span></span><span class="line"><span class="cl">  <span class="p">}]</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><p><strong>Intelligent Caching Mechanism</strong>:</p>
<ul>
<li>Global credit state management avoiding redundant API calls</li>
<li>Automated user initialization enhancing new user experience</li>
<li>30-second caching mechanism balancing performance and data freshness</li>
</ul>
<h3 id="system-design-highlights">System Design Highlights<a hidden class="anchor" aria-hidden="true" href="#system-design-highlights">#</a></h3>
<h4 id="1-user-experience-optimization">1. User Experience Optimization<a hidden class="anchor" aria-hidden="true" href="#1-user-experience-optimization">#</a></h4>
<ul>
<li><strong>Proactive Initialization Architecture</strong>: Automatic account initialization upon user login, eliminating error prompts</li>
<li><strong>Real-time Saving</strong>: Auto-save writing content preventing accidental loss</li>
<li><strong>Responsive Design</strong>: Cross-device compatibility providing consistent learning experience</li>
</ul>
<h4 id="2-data-architecture-design">2. Data Architecture Design<a hidden class="anchor" aria-hidden="true" href="#2-data-architecture-design">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- Users Table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">email</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">usage_count</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">30</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Score History Table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">score_history</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">user_id</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">question</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">essay</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">ai_response</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">ai_corrections</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><h4 id="3-error-handling--retry-mechanism">3. Error Handling &amp; Retry Mechanism<a hidden class="anchor" aria-hidden="true" href="#3-error-handling--retry-mechanism">#</a></h4>
<ul>
<li>Exponential backoff retry strategy ensuring AI API call stability</li>
<li>Graceful error recovery improving user experience</li>
<li>Detailed error logging facilitating issue diagnosis</li>
</ul>
<h2 id="technical-challenges--solutions">Technical Challenges &amp; Solutions<a hidden class="anchor" aria-hidden="true" href="#technical-challenges--solutions">#</a></h2>
<h3 id="challenge-1-ai-scoring-accuracy-and-consistency">Challenge 1: AI Scoring Accuracy and Consistency<a hidden class="anchor" aria-hidden="true" href="#challenge-1-ai-scoring-accuracy-and-consistency">#</a></h3>
<p><strong>Solution</strong>:</p>
<ul>
<li>Carefully crafted prompt engineering ensuring AI output aligns with CELPIP scoring standards</li>
<li>Extensive testing and optimization guaranteeing scoring stability</li>
<li>JSON formatted output ensuring consistent data structure</li>
</ul>
<h3 id="challenge-2-complex-user-state-management">Challenge 2: Complex User State Management<a hidden class="anchor" aria-hidden="true" href="#challenge-2-complex-user-state-management">#</a></h3>
<p><strong>Solution</strong>:</p>
<ul>
<li>Context-based global state management</li>
<li>Single source of truth architecture preventing state synchronization issues</li>
<li>Intelligent caching strategy reducing unnecessary API calls</li>
</ul>
<h3 id="challenge-3-rich-text-editor-correction-highlighting">Challenge 3: Rich Text Editor Correction Highlighting<a hidden class="anchor" aria-hidden="true" href="#challenge-3-rich-text-editor-correction-highlighting">#</a></h3>
<p><strong>Solution</strong>:</p>
<ul>
<li>Custom Slate.js renderer</li>
<li>Character index-based precise positioning</li>
<li>Dynamic styling application achieving real-time highlighting effects</li>
</ul>
<h2 id="project-structure">Project Structure<a hidden class="anchor" aria-hidden="true" href="#project-structure">#</a></h2>
<pre tabindex="0"><code>celpip/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/                 # Next.js App Router
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/            # API Routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ writing/        # Writing Practice Page
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ history/        # History Page
‚îÇ   ‚îú‚îÄ‚îÄ components/         # React Components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Essay.tsx       # Core Writing Editor
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Score.tsx       # Score Display Component
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SampleAnswersPanel.tsx # Sample Comparison Panel
‚îÇ   ‚îú‚îÄ‚îÄ contexts/           # React Context
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EssayContext.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UserContext.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ LanguageContext.tsx
‚îÇ   ‚îú‚îÄ‚îÄ hooks/              # Custom Hooks
‚îÇ   ‚îú‚îÄ‚îÄ lib/                # Utilities and API Wrappers
‚îÇ   ‚îî‚îÄ‚îÄ data/               # Question Bank and Sample Data
‚îú‚îÄ‚îÄ public/                 # Static Assets
‚îî‚îÄ‚îÄ vercel.json            # Deployment Configuration
</code></pre><h2 id="core-feature-implementation">Core Feature Implementation<a hidden class="anchor" aria-hidden="true" href="#core-feature-implementation">#</a></h2>
<h3 id="intelligent-scoring-engine">Intelligent Scoring Engine<a hidden class="anchor" aria-hidden="true" href="#intelligent-scoring-engine">#</a></h3>
<p>Based on OpenAI o1-mini model, I designed a dual-phase assessment system:</p>
<ol>
<li><strong>Overall Scoring</strong>: Comprehensive 1-12 scale evaluation following CELPIP official standards</li>
<li><strong>Detailed Corrections</strong>: Word-by-word analysis providing specific improvement suggestions and grammar corrections</li>
</ol>
<h3 id="smart-sample-matching">Smart Sample Matching<a hidden class="anchor" aria-hidden="true" href="#smart-sample-matching">#</a></h3>
<ul>
<li>Automatic detection of user-selected questions</li>
<li>Matching relevant content from 90+ official samples</li>
<li>Score range filtering to study writing techniques at different proficiency levels</li>
</ul>
<h3 id="personalized-learning-path">Personalized Learning Path<a hidden class="anchor" aria-hidden="true" href="#personalized-learning-path">#</a></h3>
<ul>
<li>Recording user writing history and performance changes</li>
<li>Providing personalized learning recommendations</li>
<li>Multi-language interface support (Chinese/English switching)</li>
</ul>
<h2 id="deployment--operations">Deployment &amp; Operations<a hidden class="anchor" aria-hidden="true" href="#deployment--operations">#</a></h2>
<h3 id="production-environment-deployment">Production Environment Deployment<a hidden class="anchor" aria-hidden="true" href="#production-environment-deployment">#</a></h3>
<ul>
<li><strong>Vercel</strong>: Zero-configuration deployment with automatic CI/CD</li>
<li><strong>Edge Computing</strong>: Global CDN acceleration reducing access latency</li>
<li><strong>Database</strong>: Vercel Postgres with auto-scaling capabilities</li>
<li><strong>Monitoring</strong>: Built-in error tracking and performance monitoring</li>
</ul>
<h3 id="security-assurance">Security Assurance<a hidden class="anchor" aria-hidden="true" href="#security-assurance">#</a></h3>
<ul>
<li><strong>Clerk Authentication</strong>: Enterprise-grade user authentication and permission management</li>
<li><strong>API Security</strong>: All sensitive operations require user authentication</li>
<li><strong>Data Encryption</strong>: End-to-end encryption for user data transmission and storage</li>
</ul>
<h2 id="project-outcomes">Project Outcomes<a hidden class="anchor" aria-hidden="true" href="#project-outcomes">#</a></h2>
<h3 id="technical-metrics">Technical Metrics<a hidden class="anchor" aria-hidden="true" href="#technical-metrics">#</a></h3>
<ul>
<li><strong>Bundle Size</strong>: Homepage 6.68KB, Writing page 80.8KB</li>
<li><strong>Performance</strong>: Lighthouse score 95+</li>
<li><strong>Availability</strong>: 99.9% uptime</li>
<li><strong>Response Time</strong>: AI scoring average 15-30 seconds</li>
</ul>
<h3 id="user-experience">User Experience<a hidden class="anchor" aria-hidden="true" href="#user-experience">#</a></h3>
<ul>
<li><strong>Intuitive Interface</strong>: Three-column layout with clear functional areas</li>
<li><strong>Instant Feedback</strong>: Real-time display of writing suggestions and scoring results</li>
<li><strong>Learning Effectiveness</strong>: Detailed improvement suggestions and sample comparisons</li>
</ul>
<h2 id="future-roadmap">Future Roadmap<a hidden class="anchor" aria-hidden="true" href="#future-roadmap">#</a></h2>
<h3 id="feature-expansion">Feature Expansion<a hidden class="anchor" aria-hidden="true" href="#feature-expansion">#</a></h3>
<ul>
<li><input disabled="" type="checkbox"> Speaking practice module integration</li>
<li><input disabled="" type="checkbox"> Additional AI model support (Claude, Gemini, etc.)</li>
<li><input disabled="" type="checkbox"> Learning analytics dashboard</li>
<li><input disabled="" type="checkbox"> Community features and study groups</li>
</ul>
<h3 id="technical-optimization">Technical Optimization<a hidden class="anchor" aria-hidden="true" href="#technical-optimization">#</a></h3>
<ul>
<li><input disabled="" type="checkbox"> Server-side rendering optimization</li>
<li><input disabled="" type="checkbox"> Offline mode support</li>
<li><input disabled="" type="checkbox"> Mobile app development</li>
<li><input disabled="" type="checkbox"> Multi-language AI assessment support</li>
</ul>
<h2 id="technical-value">Technical Value<a hidden class="anchor" aria-hidden="true" href="#technical-value">#</a></h2>
<p>This project demonstrates my technical capabilities in the following areas:</p>
<ol>
<li><strong>Full-Stack Development</strong>: Complete implementation from frontend UI to backend API</li>
<li><strong>AI Integration</strong>: Deep integration of OpenAI API and prompt engineering</li>
<li><strong>User Experience Design</strong>: Simplified expression of complex functionality</li>
<li><strong>System Architecture</strong>: Scalable modular design</li>
<li><strong>Performance Optimization</strong>: Caching strategies and state management optimization</li>
<li><strong>Production Deployment</strong>: Modern DevOps practices</li>
</ol>
<p>This project not only addresses real learning needs but also fully demonstrates modern web development best practices and the practical application value of AI technology.</p>
<h2 id="professional-skills-demonstrated">Professional Skills Demonstrated<a hidden class="anchor" aria-hidden="true" href="#professional-skills-demonstrated">#</a></h2>
<h3 id="frontend-development">Frontend Development<a hidden class="anchor" aria-hidden="true" href="#frontend-development">#</a></h3>
<ul>
<li><strong>React Ecosystem</strong>: Advanced usage of React 18, custom hooks, context management</li>
<li><strong>TypeScript</strong>: Comprehensive type safety implementation across the entire codebase</li>
<li><strong>UI/UX Design</strong>: Responsive design with Tailwind CSS, intuitive user interfaces</li>
<li><strong>State Management</strong>: Complex application state architecture with performance optimization</li>
</ul>
<h3 id="backend-development">Backend Development<a hidden class="anchor" aria-hidden="true" href="#backend-development">#</a></h3>
<ul>
<li><strong>API Design</strong>: RESTful API design with proper error handling and validation</li>
<li><strong>Database Design</strong>: Efficient schema design and query optimization</li>
<li><strong>Authentication</strong>: Secure user management with industry-standard practices</li>
<li><strong>Performance</strong>: Caching strategies, connection pooling, and response optimization</li>
</ul>
<h3 id="aiml-integration">AI/ML Integration<a hidden class="anchor" aria-hidden="true" href="#aiml-integration">#</a></h3>
<ul>
<li><strong>Prompt Engineering</strong>: Sophisticated prompt design for consistent AI responses</li>
<li><strong>Model Integration</strong>: Production-ready OpenAI API integration with error handling</li>
<li><strong>Data Processing</strong>: Complex JSON parsing and formatting for AI responses</li>
<li><strong>Performance Tuning</strong>: Optimized API usage patterns and response caching</li>
</ul>
<h3 id="devops--production">DevOps &amp; Production<a hidden class="anchor" aria-hidden="true" href="#devops--production">#</a></h3>
<ul>
<li><strong>Deployment</strong>: Modern CI/CD pipelines with Vercel</li>
<li><strong>Monitoring</strong>: Error tracking, performance monitoring, and analytics</li>
<li><strong>Scalability</strong>: Cloud-native architecture ready for horizontal scaling</li>
<li><strong>Security</strong>: Production-grade security practices and data protection</li>
</ul>
<h2 id="open-source-contribution">Open Source Contribution<a hidden class="anchor" aria-hidden="true" href="#open-source-contribution">#</a></h2>
<p>The project is open-sourced on GitHub, welcoming community contributions and feedback. All code follows best practices with comprehensive documentation and test cases, providing valuable learning resources for other developers.</p>
<h2 id="impact--results">Impact &amp; Results<a hidden class="anchor" aria-hidden="true" href="#impact--results">#</a></h2>
<ul>
<li><strong>Problem Solving</strong>: Addressed a real market gap in CELPIP preparation tools</li>
<li><strong>Technical Innovation</strong>: Novel application of AI in language learning assessment</li>
<li><strong>User Value</strong>: Provided accessible, high-quality language learning assistance</li>
<li><strong>Code Quality</strong>: Production-ready codebase demonstrating professional development standards</li>
</ul>
<p>This project represents a comprehensive demonstration of modern full-stack development capabilities, AI integration expertise, and user-centered design principles‚Äîall essential skills for senior developer positions in today&rsquo;s technology landscape.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/celpip/">CELPIP</a></li>
      <li><a href="http://localhost:1313/tags/ai/">AI</a></li>
      <li><a href="http://localhost:1313/tags/language-learning/">Language Learning</a></li>
      <li><a href="http://localhost:1313/tags/openai/">OpenAI</a></li>
      <li><a href="http://localhost:1313/tags/next.js/">Next.js</a></li>
      <li><a href="http://localhost:1313/tags/full-stack/">Full-Stack</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="http://localhost:1313/projects/celpip12/">
    <span class="title">Next ¬ª</span>
    <br>
    <span>CELPIP12 - From Personal Pain Point to Full-Stack AI Solution</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">lula&#39;s blog</a></span> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
    
<div class="busuanzi-footer">
  <span id="busuanzi_container_site_pv">
    Total views: <span id="busuanzi_value_site_pv"></span> 
  </span>
</div></footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
